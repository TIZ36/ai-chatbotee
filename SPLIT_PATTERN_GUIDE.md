# ✂️ 简化模式分割规则使用指南

## 功能说明

当您使用简化模式（只标记 Item，不标记 Title 和 Content）时，系统会自动提取每个 Item 的所有文本。但有时候，您需要更精确地分割标题和内容。

**分割规则**就是用来告诉系统：如何将提取的文本分成"标题"和"内容"两部分。

## 三种分割策略

### 1. 首行模式（默认）

**适用场景：** 标题总是在第一行，且较短（<100字符）

**工作原理：**
- 第一行（如果 < 100 字符）→ 标题
- 剩余行 → 内容

**示例：**

输入文本：
```
担任雅思写作考官
我希望你假定自己是雅思写作考官，根据雅思评判标准...
```

输出：
- 标题：`担任雅思写作考官`
- 内容：`我希望你假定自己是雅思写作考官，根据雅思评判标准...`

**无需配置！这是默认模式。**

---

### 2. 正则表达式分割

**适用场景：** 需要按特定模式分割（换行、特殊符号等）

#### 常用正则表达式

| 模式 | 说明 | 示例 |
|------|------|------|
| `\n\n` | 按双换行分割 | 段落之间用空行分隔 |
| `\n(?=[\u4e00-\u9fa5])` | 在中文字符前换行分割 | 标题后紧跟中文内容 |
| `\n点击复制\n` | 按"点击复制"分割 | 有明确分隔符 |
| `\n#\s` | 在 Markdown 标题前分割 | `# 标题` 格式 |

#### 使用示例

**场景：** 您的数据是这样的：

```
担任雅思写作考官

点击复制

我希望你假定自己是雅思写作考官，根据雅思评判标准...
```

**配置：**
1. 分割策略：选择 `正则表达式分割`
2. 正则表达式：输入 `\n点击复制\n`

**结果：**
- 标题：`担任雅思写作考官`
- 内容：`我希望你假定自己是雅思写作考官，根据雅思评判标准...`

（"点击复制"被去掉了）

---

### 3. 关键词分割

**适用场景：** 有明确的分隔关键词

**工作原理：**
- 关键词之前 → 标题
- 关键词及之后 → 内容

#### 使用示例

**场景：** 您的数据是这样的：

```
担任雅思写作考官
点击复制
#
我希望你假定自己是雅思写作考官，根据雅思评判标准...
```

**配置：**
1. 分割策略：选择 `关键词分割`
2. 分割关键词：输入 `点击复制`

**结果：**
- 标题：`担任雅思写作考官`
- 内容：`点击复制 # 我希望你假定自己是雅思写作考官...`

**注意：** 关键词会保留在内容中！

---

## 实际操作步骤

### 步骤 1: 标记 Item

1. 点击 **"标记项"** 按钮
2. 在页面中点击一个 item 容器
3. 查看元素预览，确认提取的文本

### 步骤 2: 查看分割配置面板

标记成功后，会自动显示**黄色的分割规则面板**：

```
┌─────────────────────────────────────────┐
│ ✂️ 简化模式 - 内容分割规则（可选）       │
│                                         │
│ 分割策略：                              │
│ ☑ 首行模式（默认，第一行作为标题）       │
│ ☐ 正则表达式分割                         │
│ ☐ 关键词分割                             │
└─────────────────────────────────────────┘
```

### 步骤 3: 选择并配置分割策略

#### 如果使用首行模式（默认）
- **不需要任何配置！**
- 直接查看预览

#### 如果使用正则表达式
1. 选择 `正则表达式分割`
2. 输入正则表达式（例如：`\n\n`）
3. 系统会自动重新预览

#### 如果使用关键词分割
1. 选择 `关键词分割`
2. 输入关键词（例如：`点击复制`）
3. 系统会自动重新预览

### 步骤 4: 查看预览

切换到 **"数据项"** 标签页，查看分割后的结果：

```
Item #1
担任雅思写作考官
我希望你假定自己是雅思写作考官，根据雅思评判标准...

Item #2
充当 Linux 终端
我想让你充当 Linux 终端...
```

### 步骤 5: 保存数据

确认分割效果满意后，点击 **"生成并保存解析数据"**。

---

## 常见问题

### Q1: 正则表达式怎么写换行符？

**A:** 在输入框中：
- 输入 `\n` 表示一个换行
- 输入 `\n\n` 表示两个换行（空行）
- 输入 `\n(?=中文)` 表示在"中文"前的换行

### Q2: 为什么分割后标题是空的？

**A:** 可能的原因：
1. **首行模式**：第一行超过 100 字符，被认为太长不适合做标题
2. **正则模式**：正则表达式没有匹配到，回退到首行模式
3. **关键词模式**：关键词未找到，回退到首行模式

**解决方法：** 检查后端日志，查看具体原因：
```
[Normalizer] Item 1: 正则分割失败，回退到首行模式
```

### Q3: 如何查看分割是否成功？

**A:** 查看后端日志：

**成功：**
```
[Normalizer] Item 1: 正则分割成功 - title_len=7, content_len=142
[Normalizer] Item 2: 关键词分割成功 - title_len=8, content_len=98
```

**失败（自动回退）：**
```
[Normalizer] Item 1: 正则分割失败，回退到首行模式
[Normalizer] Item 1: 首行模式 - title_len=7, content_len=142
```

### Q4: 我的数据格式很复杂，怎么办？

**建议：** 从简单开始
1. 先试试 **首行模式**（默认）
2. 如果不行，试试 **关键词分割**（最简单）
3. 最后再试 **正则表达式**（最灵活但也最复杂）

---

## 针对您的场景（ChatGPT Prompts）

根据您提供的示例：

```
担任雅思写作考官
[长文本内容]
点击复制
#
充当 Linux 终端
[长文本内容]
点击复制
```

### 推荐方案 1: 关键词分割

**配置：**
- 分割策略：`关键词分割`
- 分割关键词：`点击复制`

**优点：** 简单直接，不需要写正则表达式

**缺点：** "点击复制"会保留在内容中

---

### 推荐方案 2: 正则表达式

**配置：**
- 分割策略：`正则表达式分割`
- 正则表达式：`\n点击复制\n#\n`

**优点：** 可以完全去掉"点击复制"和"#"

**缺点：** 正则表达式稍微复杂一点

---

### 推荐方案 3: 首行模式（最简单）

如果您的标题总是第一行且较短，**什么都不用配置**，使用默认的首行模式即可！

---

## 测试建议

1. **先标记一个 Item** → 查看元素预览
2. **尝试不同的分割策略** → 观察预览变化
3. **查看后端日志** → 确认分割是否成功
4. **满意后保存** → 应用到所有 Item

**提示：** 分割配置会应用到**所有 Item**，所以确保大部分 Item 都能正确分割！

---

## 后端日志示例

成功使用正则分割：
```
[Normalizer] 分割策略: regex, 分割模式: '\n点击复制\n'
[Normalizer] Item 1: 正则分割成功 - title_len=7, content_len=142
[Normalizer] Item 2: 正则分割成功 - title_len=9, content_len=98
...
[Normalizer] ✅ 简化模式完成，提取了 123 个文本快照
```

---

## 下一步

现在：
1. ✅ **重启后端服务器**
2. ✅ **刷新前端页面**
3. ✅ **标记 Item**
4. ✅ **配置分割规则**
5. ✅ **查看预览**
6. ✅ **保存数据**

试试看吧！🎉
