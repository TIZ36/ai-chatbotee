---
alwaysApply: true
---

# 依赖管理规则

## 核心原则

**无论前后端添加什么新功能，如果有依赖的改变，都必须同步更新相关的安装脚本。**

## 需要维护的安装脚本

### Ubuntu/Linux 环境
- `init_ubuntu.sh` - Ubuntu 环境初始化脚本
- `setup-ubuntu.sh` - 如果存在，需要同步更新

### macOS/通用环境
- `setup.sh` - 如果存在，需要同步更新

## 依赖变更检查清单

### 前端依赖变更
当 `package.json` 中的 `dependencies` 或 `devDependencies` 发生变化时：

1. ✅ 检查安装脚本是否包含 `npm install` 命令
2. ✅ 检查是否需要安装新的系统依赖（如 `node-pty` 需要编译工具）
3. ✅ 检查是否需要特殊的构建步骤（如 `electron-rebuild`）
4. ✅ 更新安装脚本中的相关说明和注释

### 后端依赖变更
当 `backend/requirements.txt` 发生变化时：

1. ✅ 检查安装脚本是否包含 `pip install -r requirements.txt` 命令
2. ✅ 检查是否需要安装新的系统依赖（如数据库驱动需要系统库）
3. ✅ 检查是否需要特殊的安装步骤（如编译扩展模块）
4. ✅ 更新安装脚本中的相关说明和注释

## 示例场景

### 场景1：添加新的 npm 包
```bash
# 如果添加了需要编译的原生模块（如 node-pty）
# 需要在安装脚本中添加编译步骤：
npx electron-rebuild -f -w node-pty
```

### 场景2：添加新的 Python 包
```bash
# 如果添加了需要系统库的包（如 mysqlclient）
# 需要在安装脚本中添加系统依赖：
sudo apt install -y default-libmysqlclient-dev
```

### 场景3：添加新的系统依赖
```bash
# 如果新功能需要系统工具（如 ffmpeg）
# 需要在安装脚本中添加：
sudo apt install -y ffmpeg
```

## 更新流程

1. **修改依赖文件**（`package.json` 或 `backend/requirements.txt`）
2. **立即更新所有相关的安装脚本**
3. **测试安装脚本**确保新环境可以正常安装
4. **更新文档**（如 README.md）说明新的依赖要求

## 注意事项

- 安装脚本应该能够在新环境中从头开始安装所有依赖
- 安装脚本应该处理依赖安装失败的情况
- 安装脚本应该提供清晰的错误提示和解决建议
- 对于可选依赖，应该在脚本中明确标注
