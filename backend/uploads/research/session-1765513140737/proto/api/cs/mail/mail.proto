syntax = "proto3";
package mail;

import "msg/msg.proto";
import "msg/mail_msg.proto";
import "enumx/csv_enumx.proto";
import "third/github.com/gogo/protobuf/gogoproto/gogo.proto";
import "third/github.com/go-proto-validators/validator.proto";

option go_package = "verse/backend/pb/pb_mail";
option (gogoproto.goproto_getters_all) = false;

message Up_Union {
  oneof body {
    option (validator.oneof)             = {required: true};
    Up_OpenPanel      openPanel          = 1; // 打开邮箱, MailTabType对应停留tab页
    Up_QueryMails     queryMails         = 2; // 根据邮件id列表 拉取邮件详细内容（分页滑动时也走这个）
    Up_ReadMails      readMails          = 3; // 标记已读
    Up_DelMails       deleteMails        = 4; // 删除1-N封邮件
    enumx.MailTabType deleteAllMails     = 5; // 删除某类型所有无附件或附件已领取的已读邮件
    uint32            recvOneReward      = 6; // 领取邮件奖励
    enumx.MailTabType recvAllReward      = 7; // 领取某类型所有邮件奖励，并将无附件的邮件和领取奖励成功的邮件标记为已读状态
    Up_SetCollection  setCollection      = 8; // 设置收藏
    msg.MailFeedback  feedback           = 9; // 点赞或点踩 或者取消点赞、取消点踩
    msg.Empty         pullSummaries      = 10; // 拉取邮件列表 登录后客户端主动拉取
    uint32            clickQuestionnaire = 11; // 点击问卷调查
    UpPullShareMail   pullShareMail      = 12; // 拉取分享邮件
    uint32            clickHyperlink     = 13; // 点击超链接
  }
}

message Dn_Union {
  oneof body {
    Dn_OpenPanel     openPanel          = 1;
    Dn_QueryMails    queryMails         = 2;
    msg.Empty        readMails          = 3;
    msg.Empty        deleteMails        = 4;
    msg.MailsUpdate  deleteAllMails     = 5;
    msg.Reward       recvOneReward      = 6;
    Dn_RecvAllReward recvAllReward      = 7;
    msg.MailsUpdate  setCollection      = 8;
    msg.MailsUpdate  feedback           = 9; // 点赞或点踩 或者取消点赞、取消点踩
    Dn_PullSummaries pullSummaries      = 10; // 拉取邮件列表 登录后客户端主动拉取
    msg.Mail         clickQuestionnaire = 11; // 点击问卷调查 更新邮件状态
    DnPullShareMail  pullShareMail      = 12; // 拉取分享邮件
    msg.Mail         clickHyperlink     = 13; // 点击超链接 更新邮件状态
  }
}

message Dn_PullSummaries {
  repeated msg.MailSummary summaries = 1 [(gogoproto.nullable) = false]; // 全量邮件简要信息,包含收藏的邮件 [客户端计算红点和气泡用]
}

message Up_OpenPanel {
  enumx.MailTabType tabType       = 1; // 打开邮箱, MailType对应停留tab页
  bool              needSummaries = 2; // 是否需要拉取邮件Summaries列表
}

// 客户端尽量避免频繁请求
message Dn_OpenPanel {
  repeated msg.MailSummary summaries = 1 [(gogoproto.nullable) = false]; // 全量邮件简要信息,包含收藏的邮件 [客户端计算红点和气泡用]
  repeated msg.Mail        mails     = 2; // 邮箱第一页邮件 [默认第一栏最新100条]
}

// 客户端已有summaries的情况下，通过这个接口拉取邮件列表（分页显示）
message Up_QueryMails {
  repeated uint32 ids = 1[(validator.field) = {repeated_count_max:10000}];
}

message Up_ReadMails {
  repeated uint32 ids = 1[(validator.field) = {repeated_count_max:10000}];
}

message Dn_QueryMails {
  repeated msg.Mail mails = 1;
}

message Up_DelMails {
  repeated uint32 ids = 1;
}

message Dn_RecvAllReward {
  msg.Reward        reward = 1;
  repeated msg.Mail mails  = 2; // 邮箱第一页邮件
}

message Up_SetCollection {
  repeated uint32 ids = 1[(validator.field) = {repeated_count_max:10000}];
}

message Up_CancelCollection {
  repeated uint32 ids = 1[(validator.field) = {repeated_count_max:10000}];
}

message UpPullShareMail {
  int64  uid    = 1;
  uint32 mailId = 2; // 邮件id
}

message DnPullShareMail {
  msg.Mail mail = 1; // 邮件内容
}
