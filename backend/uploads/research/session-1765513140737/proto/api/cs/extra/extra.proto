syntax = "proto3";
package extra;

import "msg/msg.proto";
import "enumx/csv_enumx.proto";
import "enumx/enumx.proto";
import "third/github.com/gogo/protobuf/gogoproto/gogo.proto";

option go_package = "verse/backend/pb/pb_extra";
option (gogoproto.goproto_getters_all) = false;

message Extra {
  Override override = 1;// 纯数据,服务器在请求最后打包的数据,客户端收到后在主协议之后使用
}

//-----------------------------------------------------------------------
// Override
//-----------------------------------------------------------------------

//-----------------------------------------------------------------------
// Override
//-----------------------------------------------------------------------
message Override {
  OverrideItem             item           = 2;
  OverrideBuilding         building       = 3;
  // OverrideHero             hero           = 4; // deprecated sp
  OverrideResStack         resStack       = 5;
  OverrideTimeState        timeState      = 6;
  OverrideProduce          produce        = 7;
  OverrideFightPower       fightPower     = 8;
  OverrideCD               cd             = 9;
  OverrideItemList         itemList       = 10;
  OverrideCurrency         currency       = 11;
  OverrideBuff             buff           = 12;
  OverrideTask             task           = 13;
  // OverrideHomeMist         homeMist       = 14; // deprecated sp
  // OverrideGuide            guide          = 15; // deprecated sp
  // OverrideHomeGrid         homeGrid       = 16; // deprecated sp
  OverrideTownEvent        townEvent      = 17; // 内城区事件
  OverrideIconFrame        iconFrame      = 18; // 新增的头像框ID
  OverrideArena            arena          = 19; // 竞技场数据
  OverrideActivity         activity       = 20; // 新增的活动数据
  OverrideGiftPackage      giftPackage    = 21; // 礼包数据
  OverrideBattle           battle         = 22;
  OverrideCharge           charge         = 23; // 充值数据
  OverrideVip              vip            = 24; // vip数据
  OverridePrivilegeCard    privilegeCard  = 25; // 特权数据
  OverrideDailyTaskPoint   dailyTaskPoint = 26; // 每日任务活跃度数据
  OverrideUGuild           uGuild         = 27; // 玩家联盟数据
  OverrideScience          science        = 28; // 科技数据
  OverrideArmyData         armyData       = 29; // 玩家军队数据
  OverrideBuildingSlot     buildingSlot   = 30; // 建筑槽位
  // OverrideCitizenAppoint   citizenAppoint = 31; // 居民派遣 // deprecated sp
  OverrideRefundData       refundData     = 32; // 退款信息
  OverrideRedDot           redDot         = 33;//新增/变动/删除的 redDots
  // OverrideCitizenOnline    citizenOnline  = 34; // 物资居民数据 // deprecated sp
  OverrideStrength         strength       = 35; // 体力数据
  OverrideBest             best           = 36;//发生变动的best数据
  // OverrideReserve          reserve        = 37; // 预备役数据 // deprecated sp
  OverrideSpoilItem        spoilItem      = 38; // 单个新增战利品
  OverrideActPoint         actPoint       = 39; // 活动积分变化
  OverrideBase             base           = 40; // 基地数据
  OverrideEmoji            emoji          = 41; // 表情数据
  // OverrideCitizenQueue     citizenQueue   = 42; // 居民派遣 // deprecated sp
  OverrideFormation        formation      = 43;//新增或变动的 FormationGroup
  OverrideCollectReward    collectReward  = 44; // 采集奖励
  OverrideLike             like           = 46; // 点赞数据
  OverrideMisc             misc           = 47; // 其他零散数据
  OverrideTruck            truck          = 48; // 卡车数据
  OverrideCatalog          catalog        = 49; // 图鉴数据
  OverrideFeedback         feedback       = 50; // 反馈数据
  //  OverrideSchedule       schedule       = 4;//schedule
  //  OverrideModule         module         = 5;//新解锁的module
  //  OverrideTrigger        trigger        = 6;//执行成功的trigger
  //  OverrideCounter        counter        = 7;//发生变动的counter数据
  //
    OverrideAutoProduceValue autoProduce    = 60; //自动化相关数据
  OverrideChapterTask      chapterTask    = 61;
  OverrideTimedTask        timedTask      = 62;
  OverrideIncident         incident       = 63;
  OverrideDrugOrder        drugOrder      = 65;//产品订单系统
  OverrideComponent        components     = 66; //组件数据
  OverrideStaff            staffs         = 67;//员工数据
  OverrideDeadStaff        deadStaffs     = 68;//死亡员工id通知
  OverrideRadar            radar          = 69; // 雷达
}

message OverrideTimeState {
  repeated msg.TimeLimitState timeStates = 1[(gogoproto.nullable) = false]; // 新增或发生变动的 TimeState
  bool                        isAll      = 2; // 是否全量更新
}

message OverrideItem {
  repeated msg.Item items = 1;//新增或变动的 Item, 按照 ItemID 覆盖 Item,Amount = 0 表示删除
}

message OverrideBuilding {
  repeated msg.SBuilding     buildings           = 1;//新增或变动的 Building
  repeated msg.BuildingQueue buildingQueues      = 2;//新增或变动的 BuildingQueue
  repeated msg.UintBoolKV    buildingUnlockInfos = 3[(gogoproto.nullable) = false];//新增或变动的 BuildingQueueUnlockInfo
}

message OverrideHero {
  repeated msg.Hero heros     = 1;//新增或变动的 Hero
  repeated uint32   rmHeroIDs = 2;//删除的 Hero
}

message OverrideResStack {
  repeated msg.Asset resList = 1[(gogoproto.nullable) = false];//新增或发生变动的物资
}

message OverrideProduce {
  repeated msg.BuildingProduce produces = 1;//新增或发生变动的 BuildingProduce
}

message OverrideFightPower {
  repeated msg.FightPower fightPowers = 1[(gogoproto.nullable) = false]; // 新增或发生变动的 FightPower
}

message OverrideCD {
  repeated msg.CD cds = 1;//新增或发生变动的 CD
}

message OverrideItemList {
  repeated msg.ItemList assetItemList = 1;  //msg.ItemList.items 对应新增或变动的 Item, 按照 ItemID 覆盖 Item,Amount = 0 表示删除
}

message OverrideCurrency {
  repeated msg.Currency currencies = 1;//新增或发生变动的 Currency
}

message OverrideBuff {
  bool                         isAll            = 1;//是否全量更新
  repeated msg.Buff            buffs            = 2[(gogoproto.nullable) = false];  //新增或发生变动的buff数据
  repeated msg.TimeLimitedBuff timeLimitedBuffs = 3[(gogoproto.nullable) = false];//新增或发生变动的限时buff数据
}

message ActivityModuleTask {
  msg.ActivityKey                key        = 1[(gogoproto.nullable) = false];
  enumx.ActivityModule           module     = 2;
  repeated msg.Task              tasks      = 3; // 任务数据
  repeated msg.ActivityTaskGroup taskGroups = 4; // 任务组数据
}

message OverrideTask {
  repeated msg.Task           tasks               = 1; // 新增或发生变动的任务数据
  repeated uint32             rmTaskIDs           = 2; // 删除的任务数据
  repeated ActivityModuleTask activityModuleTasks = 3; // 更新活动任务数据
}

message OverrideHomeMist {
  repeated msg.HomeMistData homeMistDataList = 1;//新增或发生变动的homeMistData
}

message OverrideTownEvent {
  repeated msg.TownEvent townEvents = 1; //  内城事件
}


message OverrideRedDot {
 repeated msg.RedDot    redDots   = 1;//新增或发生变动的 redDots
 repeated msg.RedDotKey rmRedDots = 2;//删除的 redDots
}

//message OverrideSchedule {
//  repeated OverrideScheduleEntry schedules = 1;
//}
//
//message OverrideScheduleEntry {
//  uint32 id      = 1; // 活动ID
//  int64  openTs  = 2; // 开启时间
//  int64  closeTs = 3; // 结束时间
//}
//
//message OverrideCounter {
//  repeated msg.Counter counters = 1;//发生变动的counter数据
//}
//

message OverrideBest {
  repeated msg.Best bests = 1;//发生变动的best数据
}


//
//message OverrideTrigger {
//  repeated uint32 triggers = 1;//执行成功的trigger
//}

message OverrideGuide {
  repeated uint32 finishIds = 1; // 新增的指引ID
}

message OverrideHomeGrid {
  repeated msg.HomeGridData homeGridDataList = 1;//新增或发生变动的homeGridData
}

message OverrideIconFrame {
  repeated uint32 iconFrames = 1; // 新增的头像框ID
}

message OverrideArena {
  uint32 updateMask = 1; // 更新掩码（掩码索引由ArenaUpdateType定义）
}

message OverrideActivity {
  repeated msg.ActivityData activityList        = 1; // 新增的活动数据
  repeated msg.ActivityData instantActivityList = 2; // 即时活动数据
  repeated msg.ActivityKey  removeActivityKeys  = 3[(gogoproto.nullable) = false]; // 删除的活动数据
}

message OverrideGiftPackage {
  repeated uint32               pendingTriggerIDs      = 1; // 待触发的triggerID
  repeated msg.GiftPackageGroup groups                 = 2; // 礼包组
  repeated msg.GiftPackageGroup airDropGroups          = 3;
  repeated msg.GiftPackageGroup removedGroups          = 4; // 需要同时判断groupID和scheduleID，因为触发礼包groupID可能会相同
  repeated uint32               removedAirDropGroupIDs = 5;
}

message OverrideBattle {
  repeated msg.Campaign campaignStages = 1; // 战役数据
}

message OverrideCharge {
  uint32 sum = 1; // 累计充值总额
}
message OverrideVip {
  int64           endTs       = 1; // vip结束时间戳
  uint32          level       = 2; // vip等级
  msg.VipTimeData vipTimeData = 3;
}
message OverridePrivilegeCard {
  repeated msg.PrivilegeCardItem cardItems = 1; // 特权卡
}
message OverrideDailyTaskPoint {
  msg.DailyTaskData dailyTaskData = 1; // 每日任务数据
}

message OverrideUGuild {
  repeated msg.UGuildHelpEntry reqHelpList = 1[(gogoproto.nullable) = false]; // 请求帮助信息，客户端收到这个数据后，直接覆盖本地缓存。
}

message OverrideArmyData {
  repeated msg.ArmyInfo              armyInfos          = 1; // 玩家军队数据
  repeated uint32                    delArmyIDs         = 2; // 删除的军队ID列表
  bool                               notifySelfGarrison = 3; // 通知客户端更新自己驻防列表
  repeated msg.SelfFormationGarrison selfGarrisonList   = 4; // 自己驻防列表
}

message OverrideScience {
  repeated msg.ScienceQueue changedQueueList = 1; // 科技队列数据,新增或者变动的科技研究队列
  repeated msg.UintBoolKV   queueUnlockInfo  = 2[(gogoproto.nullable) = false]; // 科技队列解锁情况(第一个队列默认解锁)
}

message OverrideBuildingSlot{
  repeated msg.BuildingSlotData buildingSlotData = 1[(gogoproto.nullable) = false];
}
message OverrideCitizenAppoint{
  repeated msg.Uint32KV appointData = 1[(gogoproto.nullable) = false];
}
message OverrideRefundData{
  repeated msg.RefundData refundData = 1[(gogoproto.nullable) = false];
}
message OverrideCitizenOnline{
  msg.CitizenOnlineData onlineData = 1[(gogoproto.nullable) = false];
}

message OverrideStrength {
  msg.RecoverData strength      = 1;
  int64           strengthLimit = 2; // 体力上限
}

message OverrideReserve {
  bool                     notifyDispatchReserve = 1;
  repeated msg.Uint32KV    dispatchReserves      = 2[(gogoproto.nullable) = false]; // 已出征预备役列表 key: reserveId, value: 出征数量
  bool                     notifyReserveList     = 3;
  repeated msg.ReserveUnit reserveList           = 4; // 预备役列表
  repeated msg.UintKV      individualId2Power    = 5[(gogoproto.nullable) = false]; //单个预备役经过外部buff加成后的战力key:预备役id,value:战历
}

message OverrideSpoilItem {
  msg.SpoilItem spoilItem = 1; // 单个新增战利品
}

message OverrideActPoint {
  repeated msg.ActPointData actPointData = 1; // 活动积分变化
}

message OverrideBase {
  uint32       bitmask  = 1;  // bit位对应ExtraBaseMaskType定义
  msg.WallData wallData = 2; // 城墙数据
}

message OverrideEmoji {
  repeated msg.Emoji emojis = 1; // 新增的表情
}
message OverrideCitizenQueue{
  repeated msg.CitizenQueue queueInfos = 1; // 居民队列
}
message OverrideFormation {
  repeated msg.FormationGroup formationGroups = 1;//新增或变动的 FormationGroup
}
message OverrideCollectReward{
  msg.Reward rewards = 1;
}

// TODO 这个其实应该是个display数据
message OverrideLike {
  repeated msg.Like likes = 1; // 点赞数据
}

message OverrideMisc {
  repeated uint32 removeSweepArmyIDs = 1; // 删除的扫荡军队ID列表
}

message OverrideTruck {
  uint32 todaySendCount = 1; // 今日已发送次数
  uint32 todayRobCount  = 2; // 今日已抢车次数
}
message OverrideCatalog {
  uint32                   exp      = 1;
  uint32                   level    = 2;
  uint32                   stars    = 3;
  repeated msg.CatalogInfo infoMap  = 4;
  repeated msg.CatalogInfo extraMap = 5;
}

message OverrideFeedback {
  msg.QnrInfo qnrInfo = 1; // 问卷任务信息
}


message OverrideAutoProduceValue {
  msg.SProduceExtra produceExtra = 1; // 自动化相关数据
}

message OverrideChapterTask {
  msg.ChapterInfo chapterExtra = 1; 
}

message OverrideTimedTask {
  repeated msg.TimedTask timedTaskExtra = 1; 
}


message OverrideIncident{
  msg.Incident incidentExtra = 1;
}

message OverrideDrugOrder{
  repeated uint32        removeIds = 1; // 移除的订单id
  repeated msg.DrugOrder addOrders = 2; //新增的订单
  int64                  refreshTs = 3; //下次刷新时间
}

message OverrideRadar{
  repeated msg.RadarTaskData addTasks = 1; // 新增的任务
  repeated uint64 removeTaskIDs       = 2; // 移除的任务id
}

message OverrideComponent{
  repeated msg.SBuildingComponent components = 1; //变更的组件
}

message OverrideStaff{
  repeated msg.Staff staffs = 1; //变更的员工
}

message OverrideDeadStaff{
  repeated uint32 staffIds = 1; //死亡的员工id
}