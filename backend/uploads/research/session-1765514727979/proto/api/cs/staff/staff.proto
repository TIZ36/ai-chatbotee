syntax = "proto3";
package staff;
import "msg/msg.proto";
import "enumx/enumx.proto";
import "enumx/csv_enumx.proto";
import "third/github.com/go-proto-validators/validator.proto";
import "third/github.com/gogo/protobuf/gogoproto/gogo.proto";

option go_package = "verse/backend/pb/pb_staff";
option (gogoproto.goproto_getters_all) = false;

//----------------------- RPC Union -----------------------

message Up_Union {
  oneof body {
    Up_AssignStaff             assignStaff             = 1;  // 分配员工
    Up_RemoveStaff             removeStaff             = 2;  // 移除员工
    Up_StaffsToWork            staffsToWork            = 3;  // 员工集体上工
    msg.Empty                  triggerProtest          = 5;  // 触发抗议判断
    msg.Empty                  triggerStaffSick        = 6;  // 触发员工生病判断
    msg.Empty                  requestStaffAllAttr     = 7;  // 请求员工总属性
    Up_OptimizeStaffAssignment optimizeStaffAssignment = 8; // 一键优化员工分配
    Up_ReqOneStaff             requestOneStaff         = 9;  // 请求单个员工
    msg.Empty                  requestStaffSickEnd     = 10; // 员工生病结束后客户端主动请求服务器结算
  }
}

message Dn_Union {
  oneof body {
    Dn_AssignStaff             assignStaff             = 1;  // 分配员工
    Dn_RemoveStaff             removeStaff             = 2;  // 移除员工
    Dn_StaffsToWork            staffsToWork            = 3;  // 员工集体上工
    Dn_TriggerProtest          triggerProtest          = 5;  // 触发抗议判断
    Dn_TriggerStaffSick        triggerStaffSick        = 6;  // 触发员工生病判断
    Dn_RequestStaffTotalAttr   requestStaffAllAttr     = 7;  // 请求员工数据
    Dn_OptimizeStaffAssignment optimizeStaffAssignment = 8; // 一键优化员工分配
    Dn_ReqOneStaff             requestOneStaff         = 9;  // 请求单个员工
    msg.Empty                  requestStaffSickEnd     = 10;
  }
}

//----------------------- 员工分配 -----------------------

message Up_AssignStaff {
  uint32 staffId     = 1;    // 员工id
  uint32 componentId = 2;    // 组件id
}

message Dn_AssignStaff {
  msg.SBuildingComponent component = 1;  // 影响的组件数据
  msg.Staff              staff     = 2;  // 影响的员工数据
}

message Up_RemoveStaff {
  uint32 staffId = 1;  // 员工id
}

message Dn_RemoveStaff {
  msg.SBuildingComponent component = 1;  // 影响的组件数据
  msg.Staff              staff     = 2;  // 影响的员工数据
}

//----------------------- 员工集体行动和判定 -----------------------

message Up_StaffsToWork {
  repeated uint32 staffIds    = 1;  // 员工id
  repeated int64  arriveTimes = 2;  // 到达工位时间
}

message Dn_StaffsToWork {
  repeated msg.SBuildingComponent components = 1;  // 影响的组件数据
  repeated msg.Staff              staffs     = 2;  // 影响的员工数据
}

message Dn_TriggerProtest {
  int64 globalProtestEndTime = 1;  // 抗议结束时间戳，如果为0表示没有触发
}

message Dn_TriggerStaffSick {
  repeated msg.SBuildingComponent components = 1;  // 影响的组件数据
  repeated msg.Staff              staffs     = 2;  // 影响的员工数据
}

message Dn_RequestStaffTotalAttr {
  msg.StaffAttribute staffAttr = 1[(gogoproto.nullable) = false];  // 员工主属性
  repeated uint32 staffIds = 2;      // 员工id列表
  repeated msg.StaffAttribute staffsAttr = 3[(gogoproto.nullable) = false]; //所有员工的属性列表
}

//----------------------- 一键优化员工分配 -----------------------

message StaffAssignment {
  uint32 staffId     = 1;  // 员工ID
  uint32 componentId = 2;  // 目标组件ID（0表示移除/待业）
}

message Up_OptimizeStaffAssignment {
  repeated StaffAssignment assignments = 1;  // 客户端计算的分配方案
}

message Dn_OptimizeStaffAssignment {
  uint32                          reassignedCount   = 1;  // 重新分配的员工数量
  repeated msg.SProduceSpeed      speedBefore       = 2;  // 改动前单位时间（每分产出）
  repeated msg.SProduceSpeed      speedAfter        = 3;  // 改动后单位时间产量变化（每分产出）
  repeated msg.Staff              updatedStaffs     = 4;  // 更新后的员工列表
  repeated msg.SBuildingComponent updatedComponents = 5;  // 更新后的组件列表
}

message Up_ReqOneStaff {
  uint32 staffId = 1;    // 员工id
}

message Dn_ReqOneStaff {
  msg.Staff staff = 1;  // 员工数据
}



