syntax = "proto3";
package equip;
import "msg/msg.proto";
import "enumx/csv_enumx.proto";
import "enumx/enumx.proto";
import "third/github.com/go-proto-validators/validator.proto";
import "third/github.com/gogo/protobuf/gogoproto/gogo.proto";

option go_package = "verse/backend/pb/pb_equip";
option (gogoproto.goproto_getters_all) = false;

//------------------------------------------------------------------------------------------
message Up_Union {
  oneof body {
    option (validator.oneof) = {required: true};
    Up_CardChangeEquip cardChangeEquip = 1; // 穿脱装备
    Up_LvUp lvUp = 2; // 升级装备
    Up_ResetLv resetLv = 3; // 重置等级
    Up_RefineLvUp refineLvUp = 4; // 升专精
    Up_ResetRefine resetRefine = 5; // 重置专精
  }
}

message Dn_Union {
  oneof body {
    msg.Empty cardChangeEquip = 1;
    Dn_LvUp lvUp = 2;
    Dn_ResetLv resetLv = 3;
    Dn_RefineLvUp refineLvUp = 4;
    Dn_ResetRefine resetRefine = 5;
  }
}

message Up_CardChangeEquip {
  uint32 cardTid = 1;
  repeated UpWearInfo equips = 2; // 只发装备变化的部位
}

message UpWearInfo {
  enumx.BodyPart pos = 1;
  uint64 itemUniqId = 2;  // 脱全发0，穿指定装备(Equip)发UniqId，穿未养成装备(EquipItem)发Tid
  uint32 itemTid = 3;
}

message Up_LvUp {
  uint64 itemUniqId = 1;
  uint32 itemTid = 2;
  uint32 targetLv = 3;
  repeated msg.Asset costAssets = 4;
  repeated uint64 costUniqIds = 5;
}

message Dn_LvUp {
  msg.Reward reward = 1; // 返还溢出道具
  msg.Item equip = 2; //更新後
}

message Up_ResetLv {
  uint64 itemUniqId = 1;
  bool   isFree     = 2; //是否免费重置
}

message Dn_ResetLv {
  msg.CostReward costReward = 1; //消耗及返还
}

message Up_RefineLvUp {
  uint64 itemUniqId = 1;
  uint32 targetLv = 2;
  repeated msg.Asset costAssetEquips = 3;  // 消耗的装备
  repeated uint64 costUniqIds = 4;
}

message Dn_RefineLvUp {
  msg.Reward reward = 1; // 重置的返还
  msg.Item equip = 2; //升级后的装备
}

message Up_ResetRefine {
  uint64 itemUniqId = 1;
  bool   isFree     = 2; //是否免费重置
}

message Dn_ResetRefine {
  msg.CostReward costReward = 1; //消耗及返还
}
