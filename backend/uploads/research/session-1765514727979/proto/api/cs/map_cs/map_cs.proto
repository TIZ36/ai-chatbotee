syntax = "proto3";
package map_cs;

import "enumx/enumx.proto";
import "enumx/csv_enumx.proto";
import "third/github.com/gogo/protobuf/gogoproto/gogo.proto";
import "third/github.com/go-proto-validators/validator.proto";
import "msg/msg.proto";
import "msg/map_msg.proto";

option go_package = "verse/backend/pb/pb_map_cs";
option (gogoproto.goproto_getters_all) = false;

// 地图上 除视野外的上下行 协议
message Up_Union {
  oneof body {
    option (validator.oneof)     = {required: true};
    Up_TeleportBase        teleportBase        = 1; // 同地图迁城
    Up_Attack              attack              = 2; // 攻击地图对象
    Up_GetMapMarks         getMapMarks         = 3; // 获取地图标记
    Up_AddMapMark          addMapMark          = 4; // 添加地图标记
    Up_DelMapMark          delMapMark          = 5; // 删除地图标记
    Up_EditMapMark         editMapMark         = 6; // 编辑地图标记
    Up_Garrison            garrison            = 7; // 驻防地图对象
    msg.Empty              repairWall          = 8; // 修复城防
    Up_CancelBurning       cancelBurning       = 9; // 灭火
    msg.Empty              rebuildMainBase     = 10; // 重建主基地
    Up_MoveReq             moveReq             = 11; // 移动请求
    Up_ArmyRecall          armyRecall          = 12; // 召回
    Up_GarrisonKick        garrisonKick        = 13; // 驻防踢人
    Up_QueryGarrison       queryGarrison       = 14; // 查询驻防部队
    Up_GarrisonGvgKick     garrisonGvgKick     = 15; // 联盟驻防踢人
    Up_Search              search              = 20; // 搜索
    Up_Collect             collect             = 21; // 采集
    Up_GetCollectData      getCollectData      = 22; // 采集信息
    Up_GetMiniMapInfo      getMiniMapInfo      = 23; // 获取小地图信息
    Up_SearchByObjID       searchByObjID       = 24; // objID搜索ClientObj
    Up_GetRedNameList      getRedNameList      = 25; // 获取红名列表

    Up_DetectMapBuilding   detectMapBuilding   = 29; // 探查地图建筑(主基地和gvg点)

    Up_GetGuildVillageInfo getGuildVillageInfo = 30; // 获取联盟领地信息, 同时用于地图染色等

    // gvg 点战斗相关
    Up_PreDeclareWar       PreDeclareWar       = 31; // 预宣战
    Up_CancelWar           cancelWar           = 32; // 取消宣战或者预宣战
    Up_DeclareWar          declareWar          = 33; // 宣战
    Up_GiveupVillage       giveupVillage       = 34; // 放弃村庄
    Up_CancelGiveupVillage cancelGiveupVillage = 35; // 取消放弃村庄
    Up_GetVillageInfo      getVillageInfo      = 36; // 获取村庄信息
    Up_TakeMapReward       takeMapReward       = 37; // 领取地图奖励, 包含氛围奖励
    Up_GuildAllAttack      guildAllAttack      = 40;  // 离线玩家全军出击
    Up_SetSweep            setSweep            = 41; // 设置扫荡
    Up_RemoveSweep         removeSweep         = 42; // 取消扫荡
    Up_SweepStop           sweepStop           = 43; // 停止扫荡
  }
}

message Dn_Union {
  oneof body {
    Dn_TeleportBase        teleportBase        = 1; // 迁城
    msg.Empty              attack              = 2; // 攻击地图对象
    Dn_GetMapMarks         getMapMarks         = 3; // 获取地图标记
    msg.MapMark            addMapMark          = 4; // 添加地图标记
    msg.Empty              delMapMark          = 5; // 删除地图标记
    msg.MapMark            editMapMark         = 6; // 编辑地图标记
    msg.Empty              garrison            = 7; // 驻防地图对象
    msg.Empty              repairWall          = 8; // 修复城防
    msg.Empty              cancelBurning       = 9; // 灭火
    Dn_RebuildMainBase     rebuildMainBase     = 10; // 重建主基地
    Dn_MoveReq             moveReq             = 11; // 移动请求
    Dn_ArmyRecall          armyRecall          = 12; // 召回
    msg.Empty              garrisonKick        = 13; // 驻防踢人
    Dn_QueryGarrison       queryGarrison       = 14; // 查询驻防部队
    msg.Empty              garrisonGvgKick     = 15; // 联盟驻防踢人
    Dn_Search              search              = 20; // 搜索
    Dn_Collect             collect             = 21; // 采集
    Dn_GetCollectData      getCollectData      = 22; // 采集信息
    Dn_GetMiniMapInfo      getMiniMapInfo      = 23; // 获取小地图信息
    Dn_SearchByObjID       searchByObjID       = 24; // objID搜索ClientObj
    Dn_GetRedNameList      getRedNameList      = 25; // 获取红名列表

    Dn_DetectMapBuilding   detectMapBuilding   = 29; // 探查地图建筑(主基地和gvg点)
    Dn_GetGuildVillageInfo getGuildVillageInfo = 30; // 获取联盟领地信息

    // gvg 点战斗相关
    Dn_PreDeclareWar       PreDeclareWar       = 31; // 预宣战
    Dn_CancelWar           cancelWar           = 32; // 取消宣战或者预宣战
    Dn_DeclareWar          declareWar          = 33; // 宣战
    Dn_GiveupVillage       giveupVillage       = 34; // 放弃村庄
    Dn_CancelGiveupVillage cancelGiveupVillage = 35; // 取消
    Dn_GetVillageInfo      getVillageInfo      = 36; // 获取村庄信息
    Dn_TakeMapReward       takeMapReward       = 37; // 领取地图奖励, 包含氛围奖励
    msg.Empty              guildAllAttack      = 40;  // 离线玩家全军出击
    msg.Empty              setSweep            = 41; // 设置扫荡
    msg.Empty              removeSweep         = 42; // 取消扫荡
    msg.Empty              sweepStop           = 43; // 停止扫荡
  }
}

// ---------------------------------------------- 红名列表 -----------------------------------------------------------------------
// 客户端进入地图后，需要的时候拉取全量红名列表
message Up_GetRedNameList {
}

message Dn_GetRedNameList {
  repeated msg.ClientRedNameEnemy  redNameEnemies = 1[(gogoproto.nullable) = false]; // 红名列表
}

// ---------------------------------------------- 迁城 -----------------------------------------------------------------------
message Up_TeleportBase {
  enumx.TeleportBaseType teleType = 1; // 迁城类型
  msg.IntPos             pos      = 2; // 迁城的坐标 - 联盟迁城时不用传
}

message Dn_TeleportBase {
  msg.BaseData baseData = 1; // 迁城的基础数据
}

message Up_GetMiniMapInfo {
  uint32 mapID = 1;
}

message Dn_GetMiniMapInfo {
  msg.MiniMapInfo mapInfo = 1 [(gogoproto.nullable) = false];
}

//--------------------------------------- 联盟领地 ---------------------------------------------------
message Up_GetGuildVillageInfo {
}

message Dn_GetGuildVillageInfo {
  repeated msg.GuildVillageInfo occupiedVillages = 1 [(gogoproto.nullable) = false]; // 已占领的村庄
  repeated msg.GuildVillageInfo otherVillages    = 2 [(gogoproto.nullable) = false]; // 其他村庄
  repeated msg.GuildSimpleInfo  guildInfos       = 3 [(gogoproto.nullable) = false]; // 公会简要信息
}

// ---------------------------------------------------------------------------------------------------------------------
message Up_GetMapMarks {
  bool all      = 1; // 拉取全部
  bool personal = 2; // 只拉取玩家个人收藏
  bool guild    = 3; // 只拉取联盟标记
}

message Dn_GetMapMarks {
  repeated msg.MapMark mapMarks = 1; // 地图标记列表
}

message Up_AddMapMark {
  msg.MapMark mapMark = 1; // 新增地图标记
}

message Dn_AddMapMark {
  msg.MapMark mapMark = 1; // 地图标记
}

message Up_EditMapMark {
  msg.MapMark mapMark = 1; // 地图标记
}

message Dn_EditMapMark {
  msg.MapMark mapMark = 1; // 地图标记
}

message Up_DelMapMark {
  uint32            mapId  = 1; // 所在mapID
  msg.IntPos        pos    = 2; // 标记位置
  enumx.MapMarkType type   = 3; // 标记类型
  uint32            iconID = 4; // 联盟标记的时候上传这个字段，其他不用
}

// ---------------------------------------------------------------------------------------------------------------------
message Up_MoveReq {
  uint32     armyID = 1; // 军队ID
  msg.IntPos pos    = 2 [(gogoproto.nullable) = false]; //  目标位置(6边型格子坐标)
}

message Dn_MoveReq {
  msg.Empty empty = 1; // 空消息
}

// ---------------------------------------------------------------------------------------------------------------------
message Up_ArmyRecall {
  uint32 armyID = 1; // 部队ID
}

message Dn_ArmyRecall {
  msg.Empty empty = 1; // 空消息
}

message Up_Attack {
  uint32 armyID      = 1; // 空闲的军队ID
  uint64 targetObjID = 2; // 地图对象ID
  bool isSweep = 3; // 是否为扫荡
  bool continueAttack = 4; // 是否为连续攻击
  msg.SMarchLineup lineup = 5; // 编队阵容
}

// gvg 点战斗相关

message Up_TakeMapReward {
  uint64 rewardObjID = 1; // 目标对象ID
}

message Dn_TakeMapReward {
  msg.ClientMapObj rewardObj = 1; // reward obj update , 更新次数和领取玩家列表
}

message Up_GetVillageInfo {
  uint64 targetObjID = 1; // 目标对象ID
  uint32 mapID       = 2; // obj所在地图ID, 将来多地图时用
}
message Dn_GetVillageInfo {
  msg.ClientMapObj obj = 1; // 带village详细信息村庄 (包含roundInfo)
}

message Up_PreDeclareWar {
  uint64 targetObjID = 1; // 目标对象ID
  uint32 mapID       = 2; // obj所在地图ID, 将来多地图时用
  string announceMsg = 3; // 宣战公告 自动加联盟标记
}

message Dn_PreDeclareWar {
  msg.ClientMapObj obj = 1; // 村庄信息
}

message Up_CancelWar {
  uint64 targetObjID = 1; // 目标对象ID
  uint32 mapID       = 2; // obj所在地图ID, 将来多地图时用
}
message Dn_CancelWar {
  msg.ClientMapObj obj = 1; // 村庄信息
}

message Up_DeclareWar {
  uint64 targetObjID = 1; // 目标对象ID
  uint32 mapID       = 2; // obj所在地图ID, 将来多地图时用
  string announceMsg = 3; // 宣战公告 自动加联盟标记
}

message Dn_DeclareWar {
  msg.ClientMapObj obj = 1; // 村庄信息
}

message Up_GiveupVillage {
  uint64 targetObjID = 1; // 目标对象ID
  uint32 mapID       = 2; // obj所在地图ID, 将来多地图时用
}
message Dn_GiveupVillage {
  msg.ClientMapObj obj = 1; // 村庄信息
}

message Up_CancelGiveupVillage {
  uint64 targetObjID = 1; // 目标对象ID
  uint32 mapID       = 2; // obj所在地图ID, 将来多地图时用
}
message Dn_CancelGiveupVillage {
  msg.ClientMapObj obj = 1; // 村庄信息
}

// 联盟离线玩家 全军出击
message Up_GuildAllAttack {
  uint64 targetObjID = 1; // 目标村庄ID
  uint32 mapID       = 2; // obj所在地图ID, 将来多地图时用
}

message Up_Collect {
  uint32 armyID      = 1; // 空闲的军队ID
  uint64 targetObjID = 2; // 地图对象ID
  msg.SMarchLineup lineup = 3; // 编队阵容
}
message Dn_Collect{
  msg.Reward reward = 1; // 发的奖励(如果有)
}
// ---------------------------------------------------------------------------------------------------------------------
message Up_Search {
  enumx.SearchTableType searchType = 1; // 搜索类型
  uint32                cfgID      = 2; // Monster/Mine配置ID
}

message Dn_Search {
  repeated msg.ClientMapObj mapObjs     = 1; //
  bool                      isExtraMine = 2; // 找不到相应等级矿点，用其他矿点代替
}

// 探查地图建筑(主基地和gvg点)
message Up_DetectMapBuilding {
  uint64 targetObjID = 1; // 目标对象ID
}

// 探查地图建筑(主基地和gvg点) 返回
message Dn_DetectMapBuilding {
  uint64                objID           = 1;
  enumx.MapBuildingType buildingType    = 2;
  uint32                buildingConfID  = 3; // 建筑配置ID
  msg.MapUBI            baseOwnerInfo   = 4 [(gogoproto.nullable) = false]; // 主基地拥有者信息
  msg.GuildSimpleInfo   guildInfo       = 5 [(gogoproto.nullable) = false]; // 玩家或在村庄所属公会信息 (只需要id/shortname)
  repeated msg.GarrisonArmyInfo  helperArmyInfos = 6 [(gogoproto.nullable) = false]; // 协防部队信息
  repeated msg.GarrisonArmyInfo  selfArmyInfos   = 7 [(gogoproto.nullable) = false]; // 自己的驻防部队信息
  int64                 curWallHp       = 8; // 当前城墙血量
  int64                 maxWallHp       = 9; // 最大城墙血量
  uint32                worldID         = 10; // 所在世界ID
  msg.IntPos            pos             = 11 [(gogoproto.nullable) = false]; // 位置
}

// ---------------------------------------------------------------------------------------------------------------------

message Up_Garrison {
  uint32 armyID      = 1; // 军队ID
  uint64 targetObjID = 2; // 地图对象ID
}

// 灭火
message Up_CancelBurning {
  uint64 targetObjID = 1; // 基地对象ID
  bool   isFree      = 2; // 是否免费
  uint32 mapID       = 3; // 地图ID
}

message Up_GarrisonKick {
  uint64 armyObjID      = 1; // 部队id
}

message Up_GarrisonGvgKick {
  uint64 targetObjID = 1; // 地图对象ID
  uint64 armyObjID = 2; // 部队id
}

message Up_QueryGarrison {
  uint64 targetObjID = 1; // 地图对象ID
}

message Dn_QueryGarrison {
  repeated msg.ArmyShowDetail garrisonArmyList = 1; // 驻守部队详情
}

message Dn_RebuildMainBase {
  msg.IntPos pos = 1[(gogoproto.nullable) = false];  // 基地位置
}
// ---------------------------------------------------------------------------------------------------------------------
message Up_GetCollectData{
}

message Dn_GetCollectData {
  repeated msg.ClientMapObj mapObjs     = 1; //
  bool                      isExtraMine = 2; // 找不到相应等级矿点，用其他矿点代替
}

message Up_SetSweep {
  uint32               armyID       = 1; // 军队ID
}

message Up_RemoveSweep {
  repeated uint32 armyIDs = 1; // 扫荡军队ID列表
}

message Up_SweepStop {
  enumx.SweepStopType stopType = 1; // 停止类型
  uint32 armyID = 2;
}

message Up_SearchByObjID {
  uint64 objID = 1; // objID
}
message Dn_SearchByObjID {
  msg.ClientMapObj mapObj = 1;
}