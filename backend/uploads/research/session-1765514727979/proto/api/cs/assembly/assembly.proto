syntax = "proto3";
package assembly;

import "enumx/enumx.proto";
import "enumx/csv_enumx.proto";
import "third/github.com/gogo/protobuf/gogoproto/gogo.proto";
import "third/github.com/go-proto-validators/validator.proto";
import "msg/msg.proto";
import "msg/map_msg.proto";

option go_package = "verse/backend/pb/pb_assembly";
option (gogoproto.goproto_getters_all) = false;

// 地图上 除视野外的上下行 协议
message Up_Union {
  oneof body {
    option (validator.oneof)                        = {required: true};
    Up_StartAssembly         startAssembly          = 1; // 发起集结
    Up_JoinAssembly          joinAssembly           = 2; // 加入集结
    Up_DismissAssembly       dismissAssembly        = 3; // 解散集结
    Up_KickOutAssemblyMember kickOutAssemblyMember  = 4; // 踢出集结成员
    Up_QueryAssemblyDetail   queryAssemblyDetail    = 5; // 查询集结详情
    Up_QueryAssemblyList     queryAssemblyList      = 6; // 查询集结列表
    msg.AssemblyKey          quitAssembly           = 7; // 退出集结
    msg.Empty                queryGuildAssemblyShow = 8; // 查询公会集结展示信息
    msg.Empty                queryGvgWarPreview     = 9; // 查询gvg战事预览信息
    Up_InviteUIDList         inviteUIDList          = 10; // 邀请加入集结
  }
}

message Dn_Union {
  oneof body {
    msg.Empty                 startAssembly          = 1; // 发起集结
    msg.Empty                 joinAssembly           = 2; // 加入集结
    msg.Empty                 dismissAssembly        = 3; // 解散集结
    msg.Empty                 kickOutAssemblyMember  = 4; // 踢出集结成员
    Dn_QueryAssemblyDetail    queryAssemblyDetail    = 5; // 查询集结详情
    Dn_QueryAssemblyList      queryAssemblyList      = 6; // 查询集结列表
    msg.Empty                 quitAssembly           = 7; // 退出集结
    Dn_QueryGuildAssemblyShow queryGuildAssemblyShow = 8; // 查询公会集结展示信息
    Dn_QueryGvgWarPreview     queryGvgWarPreview     = 9; // 查询gvg战事预览信息
    msg.Empty                 inviteUIDList          = 10; // 邀请加入集结
  }
}

// 发起集结
message Up_StartAssembly {
  uint64                targetObjID = 1; // 目标对象ID
  uint32                armyID      = 2; // 空闲队伍ID
  uint32                timeIndex   = 3; // 集结时间档位（从0开始）
  enumx.RallyTargetType asmType     = 4; // 集结类型
  bool                  isSweep     = 5; // 是否扫荡
  msg.SMarchLineup    lineup   = 6; // 编队阵容
}

message Up_JoinAssembly {
  msg.AssemblyKey key    = 1[(gogoproto.nullable) = false]; // 集结key
  uint32          armyID = 2; // 空闲队伍ID
  msg.SMarchLineup    lineup   = 3; // 编队阵容
}

message Up_DismissAssembly {
  uint64 targetObjID = 1; // 集结目标对象ID
}

message Up_KickOutAssemblyMember {
  uint64 targetObjID    = 1; // 集结目标对象ID
  uint32 kickedMemberID = 2; // 被踢出的成员ID
}

message Up_QueryAssemblyDetail {
  msg.AssemblyKey key = 1[(gogoproto.nullable) = false]; // 集结key
}

message Dn_QueryAssemblyDetail {
  msg.AssemblyDetail assemblyInfo = 1; // 集结信息
}

message Up_QueryAssemblyList {
  repeated msg.AssemblyKey keyList = 1[(gogoproto.nullable) = false]; // 集结key列表（如果没有，表示查询所有）
}

message Dn_QueryAssemblyList {
  repeated msg.AssemblySimple assemblyList = 1; // 集结列表
}

message Dn_QueryGuildAssemblyShow {
  repeated msg.AssemblyShow     allShowInfo       = 1; // 所有集结展示信息
  repeated msg.GuildPersonalWar personalWarList   = 2; // 公会个人战争列表
  repeated msg.GvgWarPreview    gvgWarPreviewList = 3;
}

message Dn_QueryGvgWarPreview {
  repeated msg.GvgWarPreview gvgWarPreviewList = 1;
}

message Up_InviteUIDList {
  repeated uint32 uids  = 1[(gogoproto.nullable) = false];
  msg.AssemblyKey key   = 2[(gogoproto.nullable) = false]; // 集结key
}
